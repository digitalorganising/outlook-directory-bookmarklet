# outlook-directory-bookmarklet

A bookmarklet to get the contents of your Outlook directory into a CSV.

### Usage

1. Drag this link to your bookmark bar: **[Get Outlook Directory][bookmarklet-ref]**.
2. Go to <https://outlook.office.com/>.
3. Click the bookmark you created in step 1.

[bookmarklet-ref]: javascript:void%2520function()%7Basync%2520function%2520a()%7Bconst%2520a%3Dawait%2520cookieStore.get(%2522X-OWA-CANARY%2522)%3Bconsole.log(%2522Requesting%2520an%2520access%2520token%2520for%2520Graph...%2522)%3Bconst%2520b%3Dawait%2520fetch(%2522https%3A%2F%2Foutlook.office.com%2Fowa%2Fservice.svc%253Faction%3DGetAccessTokenforResource%2522%2C%7Bheaders%3A%7Baction%3A%2522GetAccessTokenforResource%2522%2C%2522content-type%2522%3A%2522application%2Fjson%3B%2520charset%3Dutf-8%2522%2C%2522x-owa-canary%2522%3Aa.value%2C%2522x-owa-urlpostdata%2522%3AencodeURIComponent(JSON.stringify(%7B__type%3A%2522TokenRequest%3A%2523Exchange%2522%2CResource%3A%2522https%3A%2F%2Fgraph.microsoft.com%2F%2522%7D))%2C%2522x-req-source%2522%3A%2522Mail%2522%7D%2Cmethod%3A%2522POST%2522%2Cmode%3A%2522cors%2522%2Ccredentials%3A%2522include%2522%7D)%2C%7BAccessToken%3Ac%2CAccessTokenExpiry%3Ad%7D%3Dawait%2520b.json()%3Breturn%2520console.log(%60%2525cSuccessfully%2520retrieved%2520token%2520%2525c(expires%3A%2520%24%7Bd%7D)%60%2C%2522color%3A%2520green%2522%2C%2522color%3A%2520gray%3B%2520font-style%3A%2520italic%2522)%2Cc%7Dasync%2520function*b(a%2Cc%3D0)%7Bconst%2520d%3Dnew%2520URLSearchParams(%7B%24top%3A200%2C%24skip%3Ac%2C%24orderBy%3A%2522displayName%2522%2C%24filter%3A%2522personType%2Fsubclass%2520eq%2520'OrganizationUser'%2522%7D)%2Ce%3Dawait%2520fetch(%2522https%3A%2F%2Fgraph.microsoft.com%2Fv1.0%2Fme%2Fpeople%253F%2522%2Bd.toString()%2C%7Bheaders%3A%7Bauthorization%3A%60Bearer%2520%24%7Ba%7D%60%2C%2522content-type%2522%3A%2522application%2Fjson%2522%2C%2522X-PeopleQuery-QuerySources%2522%3A%2522Mailbox%2CDirectory%2522%7D%2Cmethod%3A%2522GET%2522%2Ccredentials%3A%2522omit%2522%7D)%2Cf%3Dawait%2520e.json()%2Cg%3Df.value%3Bconsole.log(%60%2525cFetched%2520%2525c%24%7Bg.length%7D%2525c%2520people%2C%2520skipped%2520%24%7Bc%7D%60%2C%2522color%3A%2520green%2522%2C%2522font-weight%3A%2520bold%2522%2C%2522font-weight%3A%2520normal%2522)%2Cyield*g%2Cf%5B%2522%2540odata.nextLink%2522%5D%2526%2526(yield*b(a%2Cc%2Bg.length))%7Dconst%2520c%3Da%3D%253E!a.surname%7C%7C!a.givenName%2Cd%3Da%3D%253E(%7Bemail%3Aa.scoredEmailAddresses%5B0%5D.address%2Cname%3Aa.givenName%2Cdepartment%3Aa.department%2CjobTitle%3Aa.jobTitle%7D)%2Ce%3Da%3D%253EObject.values(a).map(a%3D%253E%2522string%2522%3D%3Dtypeof%2520a%253FJSON.stringify(a)%3Aa).toString()%2B%2522%5Cn%2522%3B(async%2520function()%7Bconst%2520f%3Dawait%2520window.showSaveFilePicker(%7BsuggestedName%3A%2522organisation-directory.csv%2522%2Ctypes%3A%5B%7Bdescription%3A%2522CSV%2520(Comma-separated%2520values)%2522%2Caccept%3A%7B%2522text%2Fcsv%2522%3A%5B%2522.csv%2522%5D%7D%7D%5D%7D)%2Cg%3Dawait%2520f.createWritable()%2Ch%3Dawait%2520a()%3Blet%2520i%3D0%3Bfor%2520await(const%2520a%2520of%2520b(h))%7Bconst%2520b%3Dd(a)%3Bif(c(a))%7Bconsole.log(%60%2525cSkipping%2520%24%7Bb.email%7D%60%2C%2522color%3A%2520gray%3B%2520font-style%3A%2520italic%3B%2520font-size%3A%25200.5rem%2522)%3Bcontinue%7D0%3D%3D%3Di%2526%2526(await%2520g.write(Object.keys(b).toString()%2B%2522%5Cn%2522))%2Cawait%2520g.write(e(b))%2Ci%2B%3D1%7Dawait%2520g.close()%2Cconsole.log(%60%2525cWrote%2520%24%7Bi%7D%2520people%2520to%2520%24%7Bf.name%7D%60%2C%2522color%3A%2520green%3B%2520font-weight%3A%2520bold%2522)%7D)()%7D()%3B
